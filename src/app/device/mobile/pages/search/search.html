<ion-content class="ion-padding" color="light">
  <ion-searchbar
    #searchbar
    show-cancel-button="always"
    placeholder="搜尋攤位編號、名稱、作者或標籤..."
    debounce="300"
    (ionCancel)="backToMap()"
    (ionInput)="handleInput($event)"
    [value]="currSearchTerm()"
  ></ion-searchbar>
  <div class="flex flex-col">
    <div class="mt-2 mb-1 mx-4">攤位標籤</div>
    @if (!tagFetchEnd()) {
      <div class="flex items-center justify-center">
        <mat-icon
          class="animate-spin"
          aria-hidden="false"
          aria-label="auto renew"
          fontIcon="autorenew"
        ></mat-icon>
      </div>
    }
    @if (allSeriesAndTags().length) {
      <div>
        <ion-list [inset]="true" class="!mt-0">
          @for (series of allSeriesAndTags(); track $index) {
            <ion-item>
              <ion-label class="!flex items-center" (click)="checkedSeries.click()">
                <input
                  #checkedSeries
                  type="checkbox"
                  (change)="toggleSeries(series.id)"
                  [checked]="isSeriesSelected(series.id)"
                  class="h-4 w-4 rounded accent-purple-500 pointer-events-none"
                />
                <span class="text-sm text-gray-600 mx-2">{{ series.name }}</span>
                @if (selectedAdvancedTagsCount()[series.id]) {
                  <span
                    class="text-xs bg-purple-200 text-purple-800 rounded-full px-2 py-0.5 ml-2 flex inline-flex"
                  >
                    {{ selectedAdvancedTagsCount()[series.id] }}
                  </span>
                }
              </ion-label>

              <button
                (click)="openAdvancedFilterModal(series)"
                class="text-gray-500 hover:text-gray-800"
              >
                <mat-icon
                  [inline]="true"
                  aria-hidden="false"
                  aria-label="Example filter icon"
                  fontIcon="filter_alt"
                ></mat-icon>
              </button>
            </ion-item>
          }
        </ion-list>
      </div>
    }
  </div>
</ion-content>
