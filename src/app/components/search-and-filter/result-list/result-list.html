<div
  class="absolute top-0 left-0 h-full bg-white dark:bg-zinc-800 bg-opacity-90 backdrop-blur-sm z-20 w-96 lg:w-110 pt-3 pb-4 px-2 transform transition-transform duration-300 ease-in-out flex flex-col"
  [class.-translate-x-full]="!showControls()"
  [class.shadow-2xl]="showControls()"
>
  <div class="flex flex-col h-full">
    <div class="px-2 pb-3 flex items-center">
      @if (isFiltering()) {
        <div class="">套用搜尋中 搜尋結果：{{ list().length }} 筆</div>
      } @else {
        <div class="">攤位列表</div>
      }
      <div class="ml-auto">
        @if (isFiltering()) {
          <p-button
            icon="pi pi-filter-slash"
            [rounded]="true"
            [text]="true"
            size="small"
            pTooltip="清除篩選條件"
            (click)="clearFilter()"
          ></p-button>
        }
        <p-button
          icon="pi pi-times"
          size="small"
          [rounded]="true"
          [text]="true"
          (click)="close()"
        />
      </div>
    </div>

    @if (isFiltering() && list().length === 0) {
      <div class="flex-1 flex items-center justify-center">無查詢結果</div>
    }

    <div class="flex-grow min-h-0 overflow-hidden">
      <p-scrollpanel class="flex flex-grow" [style]="{ width: '100%', height: '100%' }">
        <div class="flex flex-col flex-1 px-2">
          @for (item of list(); track item) {
            @if ($index > 0) {
              <p-divider></p-divider>
            }
            <div
              class="flex items-center w-full gap-4 transition hover:scale-102 hover:cursor-pointer px-2"
              (click)="selectAndFocus(item)"
            >
              <div
                class="shrink w-[100px] h-[100px] rounded-lg border border-gray-400 overflow-hidden"
              >
                @if (item.stallImg) {
                  @let isDefaultWixImg = item.stallImg.indexOf('static.wixstatic.com/media/') > -1;
                  @if (isDefaultWixImg) {
                    @let imgName = item.stallImg.split('static.wixstatic.com/media/')[1];
                    <img
                      class="w-full h-full object-cover object-center"
                      [src]="
                        `${item.stallImg}/v1/fill/w_100,h_100,al_c,q_85,usm_0.66_1.00_0.01,enc_avif,quality_auto/${imgName}`
                      "
                    />
                  } @else {
                    <img
                      class="w-full h-full object-cover object-center"
                      [src]="`${item.stallImg}`"
                    />
                  }
                }
              </div>

              <div class="flex-1 flex flex-col gap-1">
                <div class="flex items-center gap-1">
                  <app-stall-zone-badge [stall]="item"></app-stall-zone-badge>
                  <div class="mb-[1px] text-sm">{{ item.stallTitle }}</div>
                </div>
                @if (item.stallAuthor) {
                  <div class="text-xs">{{ item.stallAuthor }}</div>
                }

                <div class="flex flex-wrap">
                  @for (promo of item.promoData; track $index) {
                    @if ($index > 0) {
                      /
                    }
                    {{ promo.promoTitle }}
                  }
                </div>
                <div class="flex flex-wrap gap-1 text-[10px]">
                  @if (multiSeriesExpo()) {
                    @for (series of item.filterSeries; track $index) {
                      <span class="promo-tag inline-flex"> #{{ series | seriesPipe }} </span>
                    }
                  } @else {
                    @for (tags of item.filterTags; track $index) {
                      <span class="promo-tag inline-flex"> #{{ tags | tagPipe }} </span>
                    }
                  }
                  @if (item.filterCustomTags.length) {
                    @for (tag of item.filterCustomTags; track $index) {
                      <span class="promo-tag inline-flex"> #{{ tag }} </span>
                    }
                  }
                </div>
              </div>
            </div>
          }
        </div>
      </p-scrollpanel>
    </div>
  </div>
</div>
