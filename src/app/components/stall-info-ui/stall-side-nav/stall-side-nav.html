<div
  class="header flex sticky top-0 z-20 bg-white shadow transition-all duration-300 w-full items-center px-5 py-4"
>
  <h2 class="modal-title mr-auto">{{ stall()?.id }}: {{ stall()?.stallTitle }}</h2>
  @if (isEditable()) {
    <app-edit-btn></app-edit-btn>
  }
  <button
    class="text-base flex items-center transition hover:scale-110"
    aria-label="Close dialog"
    (click)="closeModal()"
  >
    <mat-icon [inline]="true" class="">close</mat-icon>
  </button>
  <button
    class="bookmark-btn text-gray-200 rounded-full bg-transparent transition hover:scale-110"
    [class.active]="isMarkedSignal()"
    (click)="toggleBookmark()"
    aria-label="Bookmark"
  >
    <mat-icon class="">bookmark_star</mat-icon>
  </button>
</div>
<div>
  <div class="p-4" (click)="bodyClicked($event)">
    @if (stall()?.stallImg) {
      <div
        class="relative w-full bg-center bg-cover bg-gray-100 rounded-xl overflow-hidden border border-gray-100"
        [style.background-image]="'url(' + stall()?.stallImg + ')'"
      >
        <!-- 毛玻璃遮罩 -->
        <div class="absolute inset-0 bg-white/30 backdrop-blur-md rounded-xl"></div>

        <!-- 圖片內容（保持清晰） -->
        <img
          [src]="stall()?.stallImg"
          [attr.data-key]="stall()?.id"
          [attr.key]="stall()?.id"
          [alt]="'Official Promo Image: ' + stall()?.stallTitle"
          class="stall-promo-image aspect-video relative z-10 object-contain w-lg transition-all duration-500"
          [class.opacity-0]="!imageLoaded()"
          [class.blur-xs]="!imageLoaded()"
          [class.loaded]="imageLoaded()"
          [class.opacity-100]="imageLoaded()"
          [class.blur-none]="imageLoaded()"
          loading="lazy"
          (load)="imageLoaded.set(true)"
        />
      </div>
    }
    @if (!hasPromoInfo()) {
      暫無宣傳資訊。
    } @else {
      @if (stall()?.stallImg && stall()?.hasPromo) {
        <hr class="promo-section-separator" />
      }
      @for (item of stall()?.promoData; track $index) {
        @if ($index > 0) {
          <div class="promo-entry-separator"></div>
        }
        <div class="promo-entry">
          <div class="modal-user-info">
            <img
              [src]="item.promoAvatar ? item.promoAvatar : defaultAvatar"
              [alt]="item.promoUser"
              class="modal-avatar"
            />
            <span class="modal-username">{{ item.promoUser }}</span>
          </div>
          @if (item.promoTags && item.promoTags.length > 0) {
            <div class="promo-tags-container">
              @for (tag of item.promoTags; track $index) {
                <span class="promo-tag">#{{ tag }}</span>
              }
            </div>
          }
          <div class="promo-html-content" [innerHTML]="item.promoHTML"></div>
        </div>
      }
    }
  </div>
  <div id="modal-footer">
    @for (link of promoLinks(); track $index) {
      <a [href]="link.href" class="footer-link" target="_blank" rel="noopener noreferrer">{{
        link.text
      }}</a>
    }
  </div>
</div>
