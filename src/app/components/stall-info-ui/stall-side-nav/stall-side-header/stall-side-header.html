<div class="header flex bg-white shadow transition-all duration-300 w-full items-center px-5 py-4">
  <!-- 標題 -->
  <div class="flex mr-auto items-center h-6">
    <div class="flex gap-1">
      <div
        class="rounded-full px-2 py-1 font-sans font-semibold text-xs text-nowrap"
        [style.backgroundColor]="
          stall()?.rule?.zoneColor ? stall()?.rule?.zoneColor : 'transparent'
        "
        [style.color]="stall()?.rule?.fontColor ? stall()?.rule?.fontColor : 'text-gray-600'"
      >
        {{ stall()?.id }}
      </div>
      <div class="mt-[1px]">{{ stall()?.stallTitle }}</div>
    </div>
    @if (stall()?.stallLink) {
      <button
        class="ml-1 text-base flex items-center transition hover:scale-110 text-gray-400"
        (click)="!isPreview() && oenpLink()"
      >
        <mat-icon
          [inline]="true"
          aria-hidden="false"
          aria-label="Example link icon"
          fontIcon="open_in_new"
        ></mat-icon>
      </button>
    }
  </div>

  @if (isEditable()) {
    <!-- 投影外部的內容 -->
    <ng-content select="[editBtn]"></ng-content>
  }

  <button
    class="text-base flex items-center transition hover:scale-110"
    aria-label="Close dialog"
    (click)="onClose()"
  >
    <mat-icon [inline]="true" class="">close</mat-icon>
  </button>

  <!-- 書籤 -->
  @if (isLogin()) {
    <button
      class="bookmark-btn text-gray-200 rounded-full bg-transparent transition hover:scale-110"
      [class.active]="isMarkedSignal()"
      (click)="!isPreview() && markedListPopover.toggle($event)"
      aria-label="Bookmark"
    >
      <mat-icon class="">bookmark_star</mat-icon>
    </button>

    <p-popover #markedListPopover>
      <div class="flex flex-col gap-2 w-[150px]">
        @for (list of allMarkedList(); track $index) {
          <div class="flex items-center gap-2">
            <mat-icon inline [style.color]="list.iconColor" [fontIcon]="list.icon"></mat-icon>
            <div class="mr-auto">{{ list.listName }}</div>
            @if (list.isUpdating) {
              <button class="flex items-center text-gray-400" disabled>
                <mat-icon
                  class="animate-spin"
                  inline
                  aria-hidden="false"
                  aria-label="autorenew icon"
                  fontIcon="autorenew"
                ></mat-icon>
              </button>
            } @else if (markedMapByStallId()?.get(stallId())?.has(list.id)) {
              <button
                class="flex items-center text-gray-400 transition hover:scale-110 hover:text-gray-700"
                (click)="removeFromMarkedList(list)"
              >
                <mat-icon
                  inline
                  aria-hidden="false"
                  aria-label="remove icon"
                  fontIcon="clear"
                ></mat-icon>
              </button>
            } @else {
              <button
                class="flex items-center text-gray-400 transition hover:scale-110 hover:text-gray-600"
                (click)="addToMarkedList(list)"
              >
                <mat-icon
                  inline
                  aria-hidden="false"
                  aria-label="add icon"
                  fontIcon="add"
                ></mat-icon>
              </button>
            }
          </div>
        }
      </div>
    </p-popover>
  }
</div>
