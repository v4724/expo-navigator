<div class="modal-mini-map">
  <div
    #modalMagnifierWrapper
    id="modal-magnifier-wrapper"
    [class.hidden]="hidden()"
    [style.cursor]="cursor()"
    (mousedown)="onPanStart($event)"
    (touchstart)="onTouchStart($event)"
    (mousemove)="onPanMove($event)"
    (touchmove)="onTouchMove($event)"
    (mouseup)="onPanEnd()"
    (touchend)="onPanEnd()"
  >
    <div class="modal-magnifier-content">
      <div
        #modalVerticalStallList
        [class.hidden]="!verticalStallGroup().length"
        id="modal-vertical-stall-list"
      >
        @for (stall of verticalStallGroup(); track stall.id) {
          <app-stall class="modal-vertical-stall-item" [stall]="stall"></app-stall>
        }
      </div>

      <div
        id="modal-magnifier"
        #modalMagnifier
        [style.backgroundImage]="mapImageSrc()"
        [style.backgroundSize]="`${scaleMapImgW()}px ${scaleMapImgH()}px`"
      >
        <div
          id="modal-magnifier-stall-layer"
          #modalMagnifierStallLayer
          [style.width.px]="mapImgW()"
          [style.height.px]="mapImgH()"
        >
          @for (stall of allStalls$ | async; track $index) {
            <app-stall
              [stall]="stall"
              [hiddenIfGrouped]="true"
              [absolutePosition]="true"
            ></app-stall>
          }
          @for (row of stallGridRefs; track $index) {
            <app-stall-group-area
              [row]="row"
              (click)="verticalGroupClicked(row)"
            ></app-stall-group-area>
          }
          <div
            #highlightEl
            class="modal-stall-highlight"
            [style.visibility]="highlightVisible()"
          ></div>
        </div>
      </div>
    </div>
    <div #modalMagnifierRowIndicatorContainer id="modal-magnifier-row-indicator-container">
      <div id="modal-magnifier-row-indicator-next" class="row-indicator-adjacent"></div>
      <div id="modal-magnifier-row-indicator-current" class="row-indicator-current"></div>
      <div id="modal-magnifier-row-indicator-prev" class="row-indicator-adjacent"></div>
    </div>
    <!-- The highlight element will be injected here by JS into the wrapper -->
  </div>
  <div
    id="modal-nav-controls"
    (mouseover)="navControlMouseover($event)"
    (mouseleave)="navControlMouseleave()"
  >
    <button
      id="modal-nav-up"
      class="modal-nav-btn"
      [ngClass]="{ hidden: upVisible() }"
      [aria-label]="upLabel()"
      [disabled]="upDisabled()"
      (click)="navControlsClicked($event, 'up')"
    >
      ▲
    </button>
    <button
      id="modal-nav-left"
      class="modal-nav-btn"
      [ngClass]="{ hidden: leftVisible() }"
      [aria-label]="leftLabel()"
      [disabled]="leftDisabled()"
      (click)="navControlsClicked($event, 'left')"
    >
      ◄
    </button>
    <button
      id="modal-nav-down"
      class="modal-nav-btn"
      [ngClass]="{ hidden: downVisible() }"
      [aria-label]="downLabel()"
      [disabled]="downDisabled()"
      (click)="navControlsClicked($event, 'down')"
    >
      ▼
    </button>
    <button
      id="modal-nav-right"
      class="modal-nav-btn"
      [ngClass]="{ hidden: rightVisible() }"
      [aria-label]="rightLabel()"
      [disabled]="rightDisabled()"
      (click)="navControlsClicked($event, 'right')"
    >
      ►
    </button>
  </div>
</div>
