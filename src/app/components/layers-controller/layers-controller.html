<!-- Floating Controls Toggle Button -->
<button
  (click)="toggleControls()"
  class="absolute top-4 left-4 z-30 bg-white p-2 rounded-full shadow-lg hover:bg-gray-100 transition-transform duration-300"
  [class.translate-x-[320px]]="showControls()"
>
  <svg
    xmlns="http://www.w3.org/2000/svg"
    class="h-6 w-6 text-gray-700"
    fill="none"
    viewBox="0 0 24 24"
    stroke="currentColor"
  >
    <path
      stroke-linecap="round"
      stroke-linejoin="round"
      stroke-width="2"
      d="M4 6h16M4 12h16m-7 6h7"
    />
  </svg>
</button>

<!-- Floating Controls Panel -->
<div
  class="absolute p-4 top-0 left-0 h-full bg-white bg-opacity-90 backdrop-blur-sm shadow-2xl z-20 w-80 p-3 transform transition-transform duration-300 ease-in-out flex flex-col"
  [class.-translate-x-full]="!showControls()"
>
  <div class="overflow-y-auto flex-grow flex flex-col gap-4 p-1">
    <!-- Tag Filters Section -->
    <app-search-and-filter></app-search-and-filter>

    <!-- Layer Controls Section -->
    <div class="">
      <h2 class="text-xl font-bold text-gray-800">圖層控制</h2>

      <!-- 場內 only -->
      <div class="mb-4 border-b pb-2 pr-1">
        <button
          (click)="toggleAreaSection()"
          class="w-full flex justify-between items-center text-left font-semibold text-gray-700"
        >
          <span>場內 Only 區</span>
          <mat-icon
            aria-hidden="false"
            aria-label="Example home icon"
            fontIcon="keyboard_arrow_up"
            class="h-5 w-5 transition-transform"
            [class.rotate-180]="!isAreaSectionOpen()"
          ></mat-icon>
        </button>
        <div
          class="transition-all duration-300"
          [class.max-h-0]="!isAreaSectionOpen()"
          [class.max-h-80]="isAreaSectionOpen()"
        >
          @if (isAreaSectionOpen()) {
            @if (!areaFetchEnd()) {
              <mat-icon
                class="animate-spin"
                aria-hidden="false"
                aria-label="auto renew"
                fontIcon="autorenew"
              ></mat-icon>
            }
            @if (allAreas().length) {
              <div class="mt-2 space-y-2 pl-2" animate.enter="fade-in" animate.leave="fade-out">
                @for (area of allAreas(); track area.areaId) {
                  <label class="flex items-center space-x-2 cursor-pointer">
                    <input
                      type="checkbox"
                      [checked]="activeAreas().has(area.areaId)"
                      (change)="toggleArea(area.areaId)"
                      class="h-4 w-4 rounded accent-blue-500"
                    />
                    <span class="text-sm text-gray-600">{{ area.areaName }}</span>
                  </label>
                }
              </div>
            }
          }
        </div>
      </div>

      <!-- 已標記 -->
      <app-marked-layer></app-marked-layer>
    </div>
  </div>
</div>
